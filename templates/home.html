{% extends 'layout.html' %} {% block head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/home.css') }}"
/>
<title>Dashboard</title>
{% endblock %} {% block navbar %}
<nav class="navbar bg-[var(--kuy-merah)] absolute w-full">
  <div class="container-fluid">
    <span class="font-semibold text-white">Kuy Roti Bakar</span>
  </div>
</nav>
{% endblock %} {% block body %}
<div class="flex w-full justify-between">
  <div class="pt-12 px-3 w-2/12 h-svh bg-white">
    <ul class="flex flex-col h-full justify-between font-medium">
      <div>
        <li class="p-1"><a href="/home/pesanan">Pesanan</a></li>
        <li class="p-1"><a href="/home/user">User</a></li>
      </div>
      <li class="p-1 text-[var(--kuy-merah)]">
        <a href="/logout">Logout</a>
      </li>
    </ul>
  </div>
  <div class="px-10 pt-14 w-10/12">
    <table class="table table-striped table-hover text-sm">
      <thead>
        <tr class="align-middle text-center">
          <th rowspan="2" scope="col" colspan="2">No</th>
          <th rowspan="2" scope="col">Nama</th>
          <th rowspan="2" scope="col">No Telepon</th>
          <th scope="col" colspan="5">Pesanan</th>
          <th rowspan="2" scope="col">Total</th>
        </tr>
        <tr class="align-middle text-center">
          <th colspan="2">Roti</th>
          <th>Ukuran</th>
          <th>Rasa</th>
          <th>Topping</th>
        </tr>
      </thead>
      <tbody>
        {% for trx in transaksi %} {% set itr = loop.index %} 
        {% for psn in
        trx.pesanan["pesanan"] %}
        <tr class="align-middle text-center">
          {% if loop.first %}
          <td
            scope="row"
            rowspan="{{ trx.pesanan['pesanan'] | count if trx.pesanan['pesanan'] | count != 1 else ''}}"
          >
            {{ itr }}
          </td>
          <td
            ondblclick="updateStatus({{ trx.id }}, '{{ trx.status }}')"
            rowspan="{{ trx.pesanan['pesanan'] | count if trx.pesanan['pesanan'] | count != 1 else ''}}"
          >
            {% if trx.status == "Belum Lunas" %}
            <span class="block bg-[var(--kuy-merah)] w-3 h-3 rounded-sm"></span>
            {% else %}
            <span class="block bg-[var(--bs-teal)] w-3 h-3 rounded-sm"></span>
            {% endif %}
          </td>
          <td
            rowspan="{{ trx.pesanan['pesanan'] | count if trx.pesanan['pesanan'] | count != 1 else ''}}"
          >
            {{ trx.nama }}
          </td>
          <td
            rowspan="{{ trx.pesanan['pesanan'] | count if trx.pesanan['pesanan'] | count != 1 else ''}}"
          >
            {{ trx.nomor_telepon }}
          </td>
          {% endif %}
          <td>{{ psn["jumlah"] if psn["jumlah"] != "" else "-" }}</td>
          <td>{{ psn["roti"] if psn["roti"] != "" else "-" }}</td>
          <td>{{ psn["ukuran"] if psn["ukuran"] != "" else "-" }}</td>
          <td>{{ psn["rasa"] if psn["rasa"] != "" else "-" }}</td>
          <td>{{ psn["topping"] if psn["topping"] != none else "-" }}</td>
          {% if loop.first %}
          <td
            rowspan="{{ trx.pesanan['pesanan'] | count if trx.pesanan['pesanan'] | count != 1 else ''}}"
          >
            {{ "Rp.
            {:,.0f}".format(trx.kode_unik+trx.pesanan["total"]).replace(",",".")
            }}
          </td>
          {% endif %}
        </tr>
        {% endfor %} {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %} {% block js %}
<script>
  function updateStatus(id, status) {
    fetch(`/updateStatus/${id}/${status}/psn`, {
      method: "POST",
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.status == "success") {
          window.location.reload();
        }
      });
  }
</script>
{% endblock %}
